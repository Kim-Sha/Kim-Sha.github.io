{"componentChunkName":"component---src-templates-blog-js","path":"/nrel/serverless/","result":{"data":{"site":{"siteMetadata":{"title":"Kim Sha - Data Scientist"}},"mdx":{"fields":{"slug":"/nrel/serverless/"},"id":"c9dca1c7-049d-5093-b3ab-f3814735f7c6","excerpt":"Last time out , I built an ETL pipeline\non top of the Scrapy framework to gather data from NREL's station in Golden, CO.\nAs much as I'd enjoy dedicating my…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Serverless Web Scraping with AWS, Part II\",\n  \"date\": \"2021-02-21\",\n  \"description\": \"ETL & Analysis of Solar Irradiance Data, Part 2\",\n  \"tags\": [\"Web Scraping\", \"ETL\", \"NREL\"],\n  \"featured\": \"severless_schedule.png\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar LazyPlot = makeShortcode(\"LazyPlot\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", {\n    className: \"lead\"\n  }, \"How do I build an automated ETL pipeline from a simple web scraper? Over two posts, I document the resources I leverage to periodically extract solar irradiance and meteorological data from the Solar Energy Research Institute's (SRRL) online portal. This second post will focus on automating the ETL pipeline.\"), mdx(\"figure\", null, mdx(LazyPlot, _extends({}, irradiance_animate_south40, {\n    mdxType: \"LazyPlot\"\n  })), mdx(\"figcaption\", null, \"A taste of the measurements made by the NREL Baseline Measurement System in Golden, Colorado. This is equivalent to the solar resource for collectors with fixed-tilt and optimized for year-round performance.\")), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://kim-sha.github.io/nrel/scraper/\"\n  }), \"Last time out\"), \", I built an ETL pipeline\\non top of the Scrapy framework to gather data from NREL's station in Golden, CO.\\nAs much as I'd enjoy dedicating my remaining days to manually triggering this web\\nscraper, I can't let it conflict with my Netflix schedule. Fortunately, I'm told\\nsome guy built a slew of somewhat profitable services for this exact reason.\\nHis name is Jeff.\"), mdx(\"h2\", null, \"Core Tools\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"590px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/0ff7f8bbed78dc0358a7a8b67c364752/a7707/nrel_scraper_banner.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"31.08108108108108%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAACdfAAAnXwEdhrpqAAABeklEQVQY002RzU7bQBSF8x6VUJGQSEhI8HjsYMcT08Y0icmf4/AjiEAJCKiAllK1quQFLNghYMVj0Hfolpf6OjYgWFwd3Tvn3KszJ2eqCFkbYqkhpkap0arHyPoIQ8UINcp6248xvSElR79pTTrLeF4f6axhut1Mm5OaZKz2WOyFyM6Ast2lIFoUyzZ2xcIoCYpihbwIqao+O/0OwospypBFq02lsYexc4MzOEe4PXLC7+OON9jaOGQlatGZnHB0esnMzEfORIU4P0dB+vxM7qgH6/xLXLbCJuv7CbvTH3xYvWDp8olPf/5iOHphRXVpH084+ZawEAWMvp5zdnHNfGGBoGqhjDK21+TX1QPbwxH3xy2SccD09Irp0W9m/X3E90f8g1u9sPti+Yu2HLWR0bPlvGgiLIW5XEfYNZasBvNGG1v/WTUY4zS2KVkhRV1eY5PPnQkq2ETUBuRM710o7lsoQh8StSgrU8+eQ9Fcb5DhayhpUGmfYqr9D5Fi26/GhAhhAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Tools and process of web scraping NREL data\",\n    \"title\": \"Tools and process of web scraping NREL data\",\n    \"src\": \"/static/0ff7f8bbed78dc0358a7a8b67c364752/fcda8/nrel_scraper_banner.png\",\n    \"srcSet\": [\"/static/0ff7f8bbed78dc0358a7a8b67c364752/12f09/nrel_scraper_banner.png 148w\", \"/static/0ff7f8bbed78dc0358a7a8b67c364752/e4a3f/nrel_scraper_banner.png 295w\", \"/static/0ff7f8bbed78dc0358a7a8b67c364752/fcda8/nrel_scraper_banner.png 590w\", \"/static/0ff7f8bbed78dc0358a7a8b67c364752/efc66/nrel_scraper_banner.png 885w\", \"/static/0ff7f8bbed78dc0358a7a8b67c364752/c83ae/nrel_scraper_banner.png 1180w\", \"/static/0ff7f8bbed78dc0358a7a8b67c364752/a7707/nrel_scraper_banner.png 3850w\"],\n    \"sizes\": \"(max-width: 590px) 100vw, 590px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"I've already been using one of Jeff's 'somewhat profitable' offerings -\\nAmazon RDS - to host my Postgres instance. This time round, I'll be\\nleveraging \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/lambda/latest/dg/welcome.html\"\n  }), \"AWS Lambda\"), \",\\na compute service that allows me to farm off code that can be triggered in response\\nto manual invocations, network requests, and events. We'll be running the scraper\\nas a scheduled event, i.e., a cron job.\"), mdx(\"p\", null, \"This is where \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.serverless.com/framework/docs/providers/aws/guide/intro/\"\n  }), \"Serverless\"), \"\\ncomes in. As a framework, it handles much of the infrastructure required to\\nbuild and deploy an application using\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.serverless.com/blog/serverless-architecture-code-patterns\"\n  }), \"serverless code patterns\"), \".\\nMy use-case will be fairly simple: deploy 1 service to AWS Lambda comprised of\\n1 function that's triggered daily.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"If you haven't done so already, set up an\\n\", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&all-free-tier.sort-order=asc\"\n  }), \"AWS account\"), \".\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Install the Serverless framework with \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm install -g serverless\"), \" (requires Node.js and NPM)\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Install \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.docker.com/\"\n  }), \"Docker\"), \", which will be used to bundle\\npython dependencies for deployment.\")), mdx(\"h2\", null, \"Configuring Serverless Access to AWS\"), mdx(\"p\", null, \"In the root of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nrel-scraper\"), \" project folder (containing \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"scrapy.cfg\"), \"), we\\ninitialize and name a service from a template:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"$ serverless create --template aws-python3 --name nrel-scraper\\n\")), mdx(\"p\", null, \"This will hook us up with a series of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.serverless.com/framework/docs/providers/aws/guide/serverless.yml/\"\n  }), \"configurations\"), \"\\nprovided in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"serverless.yml\"), \", a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".gitignore\"), \", and a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"handler.py\"), \" script (more on that later).\"), mdx(\"p\", null, \"Next, you'll want to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.youtube.com/watch?v=KngM5bfpttA\"\n  }), \"generate some AWS access keys\"), \"\\nfor Serverless latch on to. If you're feeling the need for speed, you\\ncan dump them into a gitignored dotenv file and export them as environment variables\\nin your shell (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"source .env\"), \") before deployment. I prefer the more permanent\\nsolution of setting up AWS profiles under \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"~/.aws/credentials\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-ini\"\n  }), \"[serverless-admin]\\naws_access_key_id = ********************\\naws_secret_access_key = ********************\\n\")), mdx(\"p\", null, \"There are several ways to invoke different profiles during deployment, but for\\nmy purposes it's sufficient to just edit the provider field in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"serverless.yml\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\"\n  }), \"provider:\\n  name: aws\\n  runtime: python3.7\\n  lambdaHashingVersion: 20201221\\n  profile: serverless-admin\\n\")), mdx(\"h2\", null, \"Packaging the Function\"), mdx(\"p\", null, \"Up to this point, we've been manually invoking the scraper with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"scrapy crawl midc\"), \".\\nJeff wants us to package this into a neat function that handles \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"event\"), \" and\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"context\"), \" objects that are passed to it. You can read more about these arguments\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/lambda/latest/dg/python-handler.html\"\n  }), \"here\"), \".\"), mdx(\"p\", null, \"Recall that intializing Serverless provided us a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"handler.py\"), \". Since I'm not\\npassing any \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"event\"), \" data for the Lambda function to process, my handler function\\nis excruciatingly boring:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-python\"\n  }), \"# ./handler.py\\n\\nimport json\\nimport sys\\nfrom nrel_scraper.crawl import crawl\\n\\ndef scrape(event={}, context={}):\\n    crawl()\\n\\nif __name__ == \\\"__main__\\\":\\n    scrape(event)\\n\")), mdx(\"p\", null, \"The imported \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"crawl\"), \" method just replicates the manual invocation of the scaper\\nby using \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.scrapy.org/en/latest/topics/practices.html\"\n  }), \"Scrapy API\"), \"\\n(pardon the hacky \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://stackoverflow.com/questions/52291998/unable-to-get-results-from-scrapy-on-aws-lambda\"\n  }), \"sqlite3 hotfix\"), \"\\nI had to dirty my hands with):\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-python\"\n  }), \"# ./nrel_scraper/crawl.py\\n\\nimport scrapy\\nfrom scrapy.spiderloader import SpiderLoader\\nfrom scrapy.crawler import CrawlerProcess\\nfrom scrapy.utils.project import get_project_settings\\n\\n# Start sqlite3 fix\\nimport imp\\nimport sys\\nsys.modules[\\\"sqlite\\\"] = imp.new_module(\\\"sqlite\\\")\\nsys.modules[\\\"sqlite3.dbapi2\\\"] = imp.new_module(\\\"sqlite.dbapi2\\\")\\n# End sqlite3 fix\\n\\ndef crawl(spider_name=\\\"midc\\\", spider_kwargs={}):\\n\\n    project_settings = get_project_settings()\\n    spider_loader = SpiderLoader(project_settings)\\n    spider_cls = spider_loader.load(spider_name)\\n\\n    process = CrawlerProcess(project_settings)\\n    process.crawl(spider_cls, **spider_kwargs)\\n    process.start()\\n\")), mdx(\"h2\", null, \"Managing Dependencies\"), mdx(\"p\", null, \"Don't forget the never-ending joy of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.serverless.com/blog/serverless-python-packaging\"\n  }), \"bundling dependencies\"), \"\\nso that they'll be provisioned 'in the cloud'. I'll use pipenv to spawn a virtual\\nPython 3 environment:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"$ pipenv --three\\n$ pipenv shell\\n$ pipenv install <for_each_package>\\n$ pipenv lock\\n\")), mdx(\"p\", null, \"The required packages for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nrel-scraper\"), \" are Scrapy, sqlalchemy, pandas,\\npython-dotenv, and psycopg2-binary. If you ever needed proof of\\nhow over-engineered this simple scraper is, that list of bloated\\npackages should do the trick.\"), mdx(\"p\", null, \"Serverless will need to bundle these dependencies specified in the newly\\ngenerated \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Pipfile\"), \". Fortunately, there's a handy \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.serverless.com/plugins/serverless-python-requirements\"\n  }), \"plugin\"), \"\\nfor this purpose:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"$ serverless plugin install -n serverless-python-requirements\\n\")), mdx(\"p\", null, \"The plugin will be automatically added to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"serverless.yml\"), \".\\nWe'll also need to add a custom field to the latter enabling the usage of Docker\\nto compile packages that aren't native to Python:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\"\n  }), \"plugins:\\n  - serverless-python-requirements\\ncustom:\\n  pythonRequirements:\\n    slim: true # Omits tests, __pycache__, *.pyc etc\\n    usePipenv: true\\n    dockerizePip: non-linux\\n\")), mdx(\"h2\", null, \"Serverless Deployment\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"590px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/a74c77378b323ac393b9d191c36a57f7/67a79/severless_schedule.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"60.13513513513513%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB+UlEQVQoz41Ty07bQBT1z1RpVTUkGDtO/EgcO3JIcPyIG4KgIrRBTR0QbQQIqi4aVQXEpq0qRNXnBnVR2HXTLpD6He0ngPiF07GdDCZkwWJ0Z+6ce+6dO+cyU7ILVnIQ2GBNijbdx/03XUw8MLCiNotUtoYJwQSnRL7oPrBuaDn56jlaA8Ih2YRQQ6nWxtrmDvp7B6h6j5EkPi5MNKwgIrmbrSMtuiOkA0JOqSOZmYH34Cmm3U5YXWOhC6vZBSeaYAkowPB5L9qT4CWnAk23kBpDygTA22kD2y/foNN7jXVPxumWgF8bAo57BciqjTtsBYmUQZJZYdDpcwl/XkhhpTx9snPZw2TGhHm/g+8nv9FvGfi8UsSXVQ1fV1XIBQutbh/vDo9QMltIcDbWmtO4eMvhoVPFLd4Drzi0LbSH6ZwNSZ/DfruET34BH/wifvTykPIm3n/7ibPzC9QXN2DqJfzdy+Kjr+LfbgaqZtF+0gqHhxQh7TYq2G2X8WqpjJ1HZUgq8YvB7zeR4G2szFaxv1zGpOzh6JmOxoyJezl38POUMNCfgxyRjG4tw6j7EI1F8NoCFGOe6pOVbGT1eejOk/D5qu1DKM6BjWmXGRVxJk8arQwyEoKpmLhZOa5Dgg1xVwfgmrAvhexemxjqj+FG75ibjtm4RONi/wMed8BYzsy5FQAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"AWS Lambda functions can be triggered on a schedule\",\n    \"title\": \"AWS Lambda functions can be triggered on a schedule\",\n    \"src\": \"/static/a74c77378b323ac393b9d191c36a57f7/fcda8/severless_schedule.png\",\n    \"srcSet\": [\"/static/a74c77378b323ac393b9d191c36a57f7/12f09/severless_schedule.png 148w\", \"/static/a74c77378b323ac393b9d191c36a57f7/e4a3f/severless_schedule.png 295w\", \"/static/a74c77378b323ac393b9d191c36a57f7/fcda8/severless_schedule.png 590w\", \"/static/a74c77378b323ac393b9d191c36a57f7/efc66/severless_schedule.png 885w\", \"/static/a74c77378b323ac393b9d191c36a57f7/c83ae/severless_schedule.png 1180w\", \"/static/a74c77378b323ac393b9d191c36a57f7/67a79/severless_schedule.png 1408w\"],\n    \"sizes\": \"(max-width: 590px) 100vw, 590px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"All that's left is to rehaul the functions field in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"serverless.yml\"), \" to schedule\\nthe cron job and point to the correct handler method. Note that all\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html#CronExpressions\"\n  }), \"cron expressions\"), \"\\nshould be passed in UTC:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yml\"\n  }), \"functions:\\n  nrelScrape:\\n    # handler method for nrel-scraper\\n    handler: handler.scrape\\n    # Seconds until function times out\\n    timeout: 30 \\n    events:\\n      # Definition of the cron job that's passed to AWS CloudWatch\\n      - schedule:\\n          name: nrel-midc-daily-ingestion\\n          description: Scheduled daily scraping of NREL MIDC at 11:59PM MST (UTC-7:00)\\n          rate: cron(59 6 * * ? *)\\n\")), mdx(\"p\", null, \"This wraps up our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"serverless.yml\"), \". You can learn more from this\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.serverless.com/framework/docs/providers/aws/guide/serverless.yml/\"\n  }), \"example reference\"), \"\\nor check out the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/Kim-Sha/nrel-scraper\"\n  }), \"GitHub repo\"), \" for this project.\\nBut first, deploy!\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"$ serverless deploy --verbose\\n\")), mdx(\"p\", null, \"If by some miracle, the permissions across Amazon RDS, Lambda, and Serverless\\nare all perfectly aligned, c'est fini. Personally, I had to do some\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://aws.amazon.com/premiumsupport/knowledge-center/lambda-rds-connection-timeouts/\"\n  }), \"troubleshooting\"), \"\\nto grease the wheels.\"), mdx(\"p\", null, \"The function will now self-trigger according to the schedule dictated to\\nCloudWatch. You can still manually trigger the job to run on Lambda:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"$ serverless invoke -f nrelScrape --log\\n\")), mdx(\"p\", null, \"And we're done here! If you've somehow made it through this slog, I must both\\napologize and thank you for bearing with me. Now, we sit back and let the solar\\nirradiance and meteorological data from the finely calibrated pyranometers\\nand pyrheliometers of the Solar Energy Research Institute's Baseline Measurement\\nSystem roll in...\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"Serverless Web Scraping with AWS, Part II","date":"February 21, 2021","description":"ETL & Analysis of Solar Irradiance Data, Part 2","image":{"childImageSharp":{"resize":{"src":"/static/a74c77378b323ac393b9d191c36a57f7/f3583/severless_schedule.png","height":718,"width":1200}}}}},"previous":{"fields":{"slug":"/nrel/scraper/"},"frontmatter":{"title":"Serverless Web Scraping with AWS, Part I"}},"next":{"fields":{"slug":"/clean-energy-innovators/goran-bolin/"},"frontmatter":{"title":"Göran Bolin - Founder, SaltX Technology"}}},"pageContext":{"id":"c9dca1c7-049d-5093-b3ab-f3814735f7c6","slug":"/nrel/serverless/","previousPostId":"2d4c3ee2-e720-5a9b-ae1c-8d959940dcbd","nextPostId":"0315cdf4-fb2c-5cb2-81cb-edb353e47b21"}},"staticQueryHashes":["2583974970","3940526654"]}